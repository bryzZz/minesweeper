var te=(l,e,t)=>{if(!e.has(l))throw TypeError("Cannot "+t)};var f=(l,e,t)=>{if(e.has(l))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(l):e.set(l,t)};var a=(l,e,t)=>(te(l,e,"access private method"),t);const se=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}};se();function k(l,e){const t=l-.5+Math.random()*(e-l+1);return Math.round(t)}class ie{constructor(e){this.name=e,this.callbacks=[]}registerCallback(e){this.callbacks.push(e)}}class ne{constructor(){this.events={}}registerEvent(e){e in this.events&&delete this.events[e];const t=new ie(e);this.events[e]=t}dispatchEvent(e,t){this.events[e].callbacks.forEach(i=>{i(t)})}addEventListener(e,t){this.events[e].registerCallback(t)}}const m=new ne;function j({tagName:l,className:e,textContent:t,attributes:i,styles:s}){const n=document.createElement(l);if(t&&(n.textContent=t),e&&(Array.isArray(e)?n.classList.add(...e):n.classList.add(e)),i)for(const[r,o]of Object.entries(i))n.setAttribute(r,o);return s&&Object.assign(n.style,s),n}var A,re,S,le,p,M,g,H,w,V,P,de,O,ae,b,U,F,he;class oe{constructor(e){f(this,A);f(this,S);f(this,p);f(this,g);f(this,w);f(this,P);f(this,O);f(this,b);f(this,F);this.options=e,this.matrix=a(this,A,re).call(this),this.isFirstClick=!0,this.highlightedCellCoords=null}getMatrix(){return this.matrix}getOptions(){return this.options}getMinesNumber(){let e=0;return a(this,p,M).call(this,t=>{t.isFlag&&(e+=1)}),this.options.minesCount-e}leftClickHandler(e){let t=null;if(a(this,p,M).call(this,d=>{d.id===e&&(t=d)}),this.isFirstClick){const d=[t,...a(this,g,H).call(this,t.y,t.x)];a(this,S,le).call(this,d),this.isFirstClick=!1}const{isOpen:i,isMine:s,isFlag:n,number:r}=t;let o=!1;!i&&!n&&!s?(a(this,w,V).call(this,t),m.dispatchEvent("updatefield")):i&&r>0?(a(this,P,de).call(this,t),m.dispatchEvent("updatefield")):!i&&!n&&s&&(a(this,b,U).call(this),o=!0,m.dispatchEvent("updatefield")),!o&&a(this,O,ae).call(this)&&a(this,F,he).call(this)}rightClickHandler(e){for(let t=0;t<this.matrix.length;t++)for(let i=0;i<this.matrix[t].length;i++){const s=this.matrix[t][i];if(s.id===e){s.isOpen||(s.isFlag=!s.isFlag),m.dispatchEvent("updatefield");break}}}arrowsPressHandler(e){const{rowsCount:t,columnsCount:i}=this.options;if(this.highlightedCellCoords===null)this.highlightedCellCoords={y:0,x:0};else{let{y:r,x:o}=this.highlightedCellCoords;this.matrix[r][o].isHighlighted=!1,e==="left"?o-=1:e==="right"?o+=1:e==="up"?r-=1:e==="down"&&(r+=1),o<0?o=i-1:o>i-1&&(o=0),r<0?r=t-1:r>t-1&&(r=0),this.highlightedCellCoords={y:r,x:o}}const{y:s,x:n}=this.highlightedCellCoords;this.matrix[s][n].isHighlighted=!0,m.dispatchEvent("updatefield")}enterAndSpacePressHandler(){}}A=new WeakSet,re=function(){const{rowsCount:e,columnsCount:t}=this.options,i=[];let s=1;for(let n=0;n<e;n++){const r=[];for(let o=0;o<t;o++){const d={y:n,x:o,id:s.toString(),number:0,isOpen:!1,isMine:!1,isFlag:!1,isHighlighted:!1};r.push(d),s++}i.push(r)}return i},S=new WeakSet,le=function(e){const{rowsCount:t,columnsCount:i,minesCount:s}=this.options,n=[];for(let r=0;r<s;r++){let o=k(0,t-1),d=k(0,i-1),h=this.matrix[o][d];for(;n.includes(h)||e.includes(h);)o=k(0,t-1),d=k(0,i-1),h=this.matrix[o][d];n.push(h),h.isMine=!0,a(this,g,H).call(this,h.y,h.x).forEach(c=>{c.number+=1})}},p=new WeakSet,M=function(e){const{matrix:t}=this;for(let i=0;i<t.length;i++)for(let s=0;s<t[i].length;s++)e(t[i][s])},g=new WeakSet,H=function(e,t,i=this.matrix){var n;const s=[];for(let r=-1;r<=1;r++)for(let o=-1;o<=1;o++){if(r===0&&o===0)continue;const d=(n=i==null?void 0:i[e+r])==null?void 0:n[t+o];d&&s.push(d)}return s},w=new WeakSet,V=function(e){!e.isMine&&!e.isFlag&&!e.isOpen?(e.isOpen=!0,e.number===0&&a(this,g,H).call(this,e.y,e.x).forEach(i=>{a(this,w,V).call(this,i)})):e.isMine&&a(this,b,U).call(this)},P=new WeakSet,de=function(e){const t=a(this,g,H).call(this,e.y,e.x);let i=t.reduce((s,{isFlag:n})=>n?++s:s,0);e.number===i&&t.forEach(s=>{s.isFlag||a(this,w,V).call(this,s)})},O=new WeakSet,ae=function(){let e=!0;return a(this,p,M).call(this,t=>{!t.isOpen&&!t.isMine&&(e=!1)}),e},b=new WeakSet,U=function(){a(this,p,M).call(this,e=>{e.isOpen=!0}),m.dispatchEvent("lose")},F=new WeakSet,he=function(){m.dispatchEvent("win")};var q,ue,y,_,D,fe,I,me,N,pe,Y,ge,E,W,x,ve;class ce{constructor(e){f(this,q);f(this,y);f(this,D);f(this,I);f(this,N);f(this,Y);f(this,E);f(this,x);this.model=e,this.html=null,this.styles={colors:{main:"#e77d26",flag:"#646464",mine:"tomato",text:"#e5e5e5",stroke:"rgb(156, 156, 156)"},font:{size:48,family:"Roboto"}},a(this,q,ue).call(this)}getHtml(){return this.html}bindLeftClick(e){this.html.addEventListener("mousedown",t=>{if(t.button===0){const i=t.offsetY,s=t.offsetX,n=a(this,E,W).call(this,i,s).id;n&&e(n)}})}bindRightClick(e){this.html.addEventListener("mousedown",t=>{if(t.button===2){const i=t.offsetY,s=t.offsetX,n=a(this,E,W).call(this,i,s).id;n&&e(n)}})}bindArrowsPress(e){const t=["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"];document.addEventListener("keydown",i=>{const s=i.code;t.includes(s)&&e(s.slice(5).toLowerCase())})}bindEnterAndSpacePress(e){this.html.addEventListener("keydown",t=>{t.code==="Enter"&&e()})}}q=new WeakSet,ue=function(){this.html=j({tagName:"canvas",className:"minesweeper-field"}),this.html.oncontextmenu=()=>!1,a(this,y,_).call(this),m.registerEvent("updatefield"),m.addEventListener("updatefield",a(this,y,_).bind(this))},y=new WeakSet,_=function(){const e=this.model.getMatrix(),{rowsCount:t,columnsCount:i}=this.model.getOptions(),s=50,n=s*i,r=s*t,o=2,d=s*o,h=d/10,c=this.html.getContext("2d");a(this,D,fe).call(this,n,r,o),c.clearRect(0,0,n,r),a(this,x,ve).call(this),c.beginPath(),a(this,I,me).call(this,c,t,i,d,h*2),a(this,N,pe).call(this,c,e,d,h),c.closePath()},D=new WeakSet,fe=function(e,t,i){this.html.style.width=e+"px",this.html.style.height=t+"px",this.html.width=e*i,this.html.height=t*i},I=new WeakSet,me=function(e,t,i,s,n){e.strokeStyle=this.styles.colors.stroke;const r=s-n*2;for(let o=1;o<t;o++){const d=s*o;for(let h=0;h<i;h++){const c=n+h*s;e.moveTo(c,d),e.lineTo(c+r,d)}}for(let o=1;o<i;o++){const d=s*o;for(let h=0;h<t;h++){const c=n+h*s;e.moveTo(d,c),e.lineTo(d,c+r)}}e.stroke()},N=new WeakSet,pe=function(e,t,i,s){const{main:n,flag:r,mine:o}=this.styles.colors;for(let d=0;d<t.length;d++)for(let h=0;h<t[d].length;h++){const{isOpen:c,isFlag:u,isMine:v,isHighlighted:R,number:X}=t[d][h];let L="transparent",$=null;c?v&&(L=o,$="../Group 4.svg"):(L=n,u&&(L=r));const J=s+d*i,Q=s+h*i,z=i-s*2;let ee=X>0&&c&&!v?X:"";e.beginPath(),a(this,Y,ge).call(this,e,Q,J,z,5,L,ee,$,R),e.closePath()}},Y=new WeakSet,ge=function(e,t,i,s,n=5,r,o,d,h){if(typeof n=="number")n={tl:n,tr:n,br:n,bl:n};else{const c={tl:0,tr:0,br:0,bl:0};for(const u in c)n[u]=n[u]||c[u]}if(e.moveTo(t+n.tl,i),e.lineTo(t+s-n.tr,i),e.quadraticCurveTo(t+s,i,t+s,i+n.tr),e.lineTo(t+s,i+s-n.br),e.quadraticCurveTo(t+s,i+s,t+s-n.br,i+s),e.lineTo(t+n.bl,i+s),e.quadraticCurveTo(t,i+s,t,i+s-n.bl),e.lineTo(t,i+n.tl),e.quadraticCurveTo(t,i,t+n.tl,i),h&&(e.strokeStyle="rgb(56, 56, 255)",e.lineWidth=10,e.stroke()),e.fillStyle=r,e.fill(),o){const{colors:{text:c},font:{size:u,family:v}}=this.styles;e.fillStyle=c,e.font=`${u}px ${v}`,e.fillText(o,t+s/2.9,i+s/1.5)}},E=new WeakSet,W=function(e,t){const i=this.model.getMatrix();return e=Math.floor(e/50),t=Math.floor(t/50),i[e][t]},x=new WeakSet,ve=function(){this.html.addEventListener("mousemove",e=>{const t=e.offsetY,i=e.offsetX,s=a(this,E,W).call(this,t,i);s&&(s.isOpen?this.html.style.cursor="default":this.html.style.cursor="pointer")})};class Ce{constructor(e){this.options=e,this.model=null,this.view=null,this.loseCallback=null,this.winCallback=null}start(){this.model=new oe(this.options),this.view=new ce(this.model),this.view.bindLeftClick(e=>{this.model.leftClickHandler(e)}),this.view.bindRightClick(e=>{this.model.rightClickHandler(e)}),this.view.bindArrowsPress(e=>{this.model.arrowsPressHandler(e)}),this.view.bindEnterAndSpacePress(()=>{this.model.enterAndSpacePressHandler()}),m.registerEvent("lose"),m.registerEvent("win"),m.addEventListener("lose",()=>this.loseCallback()),m.addEventListener("win",()=>this.winCallback())}getView(){return this.view}onLose(e){this.loseCallback=e}onWin(e){this.winCallback=e}onMinesCounterChange(e){let t=this.model.getMinesNumber();e(t),m.addEventListener("updatefield",()=>{t=this.model.getMinesNumber(),e(t)})}}let C=new Ce({rowsCount:10,columnsCount:10,minesCount:9});const B=document.querySelector("#app"),G=B.querySelector(".header"),T=B.querySelector(".container");function K(l){var i;l.innerHTML="",C.start();const e=C.getView().getHtml();l.append(e),(i=G.querySelector(".mines-counter"))==null||i.remove();const t=j({tagName:"div",className:"mines-counter"});C.onMinesCounterChange(s=>{t.innerHTML=`Mines left: <span>${s}</span>`}),G.append(t)}K(T);const we=Ee(T);function Ee(l){const e=C.getView().getHtml();let t={top:0,left:0,x:0,y:0},i=!1,s=!1;document.addEventListener("keydown",n),document.addEventListener("keyup",r),l.addEventListener("mousedown",o);function n(u){u.code==="Space"&&(u.preventDefault(),s=!0,i||(l.style.cursor="grab"),e.classList.add("no-pointer-events"))}function r(u){u.code==="Space"&&(s=!1,i||(l.style.cursor="default",e.classList.remove("no-pointer-events")))}function o(u){s&&(i=!0,l.style.cursor="grabbing",t={left:l.scrollLeft,top:l.scrollTop,x:u.clientX,y:u.clientY},l.addEventListener("mousemove",d),l.addEventListener("mouseup",h))}function d(u){const v=u.clientX-t.x,R=u.clientY-t.y;l.scrollTop=t.top-R,l.scrollLeft=t.left-v}function h(){l.removeEventListener("mousemove",d),l.removeEventListener("mouseup",h),i=!1,s||(l.style.cursor="default",e.classList.remove("no-pointer-events"))}function c(){document.removeEventListener("keydown",n),document.removeEventListener("keyup",r),l.removeEventListener("mousedown",o)}return c}C.onWin(()=>Z("You Win!","win"));C.onLose(()=>Z("You Lose","lose"));function Z(l,e){we();const t=j({tagName:"div",className:["end-screen",e]});t.innerHTML=`
        <div>${l}</div>
        <div>Click any button to restart</div>
    `;const i=()=>{K(T),t.removeEventListener("click",i),document.removeEventListener("keypress",i),t.remove()};t.addEventListener("click",i),document.addEventListener("keypress",i),T.append(t)}
