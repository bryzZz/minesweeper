var $=(o,e,t)=>{if(!e.has(o))throw TypeError("Cannot "+t)};var p=(o,e,t)=>{if(e.has(o))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(o):e.set(o,t)};var f=(o,e,t)=>($(o,e,"access private method"),t);const z=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}};z();function L(o,e){const t=o-.5+Math.random()*(e-o+1);return Math.round(t)}class G{constructor(e){this.name=e,this.callbacks=[]}registerCallback(e){this.callbacks.push(e)}}class U{constructor(){this.events={}}registerEvent(e){e in this.events&&delete this.events[e];const t=new G(e);this.events[e]=t}dispatchEvent(e,t){this.events[e].callbacks.forEach(s=>{s(t)})}addEventListener(e,t){this.events[e].registerCallback(t)}}const u=new U;function P({tagName:o,className:e,textContent:t,attributes:s,styles:i}){const n=document.createElement(o);if(t&&(n.textContent=t),e&&(Array.isArray(e)?n.classList.add(...e):n.classList.add(e)),s)for(const[l,a]of Object.entries(s))n.setAttribute(l,a);return i&&Object.assign(n.style,i),n}var F,_,O,J,g,M,w,S,C,j,T,Q,H,Z,y,D,x,ee;class K{constructor(e){p(this,F);p(this,O);p(this,g);p(this,w);p(this,C);p(this,T);p(this,H);p(this,y);p(this,x);this.options=e,this.matrix=f(this,F,_).call(this),this.isFirstClick=!0,this.highlightedCellCoords=null}getMatrix(){return this.matrix}getOptions(){return this.options}getMinesNumber(){let e=0;return f(this,g,M).call(this,t=>{t.isFlag&&(e+=1)}),this.options.minesCount-e}leftClickHandler(e){let t=null;if(f(this,g,M).call(this,d=>{d.id===e&&(t=d)}),this.isFirstClick){const d=[t,...f(this,w,S).call(this,t.y,t.x)];f(this,O,J).call(this,d),this.isFirstClick=!1}const{isOpen:s,isMine:i,isFlag:n,number:l}=t;let a=!1;!s&&!n&&!i?(f(this,C,j).call(this,t),u.dispatchEvent("updatefield")):s&&l>0?(f(this,T,Q).call(this,t),u.dispatchEvent("updatefield")):!s&&!n&&i&&(f(this,y,D).call(this),a=!0,u.dispatchEvent("updatefield")),!a&&f(this,H,Z).call(this)&&f(this,x,ee).call(this)}rightClickHandler(e){for(let t=0;t<this.matrix.length;t++)for(let s=0;s<this.matrix[t].length;s++){const i=this.matrix[t][s];if(i.id===e){i.isOpen||(i.isFlag=!i.isFlag),u.dispatchEvent("updatefield");break}}}}F=new WeakSet,_=function(){const{rowsCount:e,columnsCount:t}=this.options,s=[];let i=1;for(let n=0;n<e;n++){const l=[];for(let a=0;a<t;a++){const d={y:n,x:a,id:i.toString(),number:0,isOpen:!1,isMine:!1,isFlag:!1,isHighlighted:!1};l.push(d),i++}s.push(l)}return s},O=new WeakSet,J=function(e){const{rowsCount:t,columnsCount:s,minesCount:i}=this.options,n=[];for(let l=0;l<i;l++){let a=L(0,t-1),d=L(0,s-1),r=this.matrix[a][d];for(;n.includes(r)||e.includes(r);)a=L(0,t-1),d=L(0,s-1),r=this.matrix[a][d];n.push(r),r.isMine=!0,f(this,w,S).call(this,r.y,r.x).forEach(h=>{h.number+=1})}},g=new WeakSet,M=function(e){const{matrix:t}=this;for(let s=0;s<t.length;s++)for(let i=0;i<t[s].length;i++)e(t[s][i])},w=new WeakSet,S=function(e,t,s=this.matrix){var n;const i=[];for(let l=-1;l<=1;l++)for(let a=-1;a<=1;a++){if(l===0&&a===0)continue;const d=(n=s==null?void 0:s[e+l])==null?void 0:n[t+a];d&&i.push(d)}return i},C=new WeakSet,j=function(e){!e.isMine&&!e.isFlag&&!e.isOpen?(e.isOpen=!0,e.number===0&&f(this,w,S).call(this,e.y,e.x).forEach(s=>{f(this,C,j).call(this,s)})):e.isMine&&f(this,y,D).call(this)},T=new WeakSet,Q=function(e){const t=f(this,w,S).call(this,e.y,e.x);let s=t.reduce((i,{isFlag:n})=>n?++i:i,0);e.number===s&&t.forEach(i=>{i.isFlag||f(this,C,j).call(this,i)})},H=new WeakSet,Z=function(){let e=!0;return f(this,g,M).call(this,t=>{!t.isOpen&&!t.isMine&&(e=!1)}),e},y=new WeakSet,D=function(){f(this,g,M).call(this,e=>{e.isOpen=!0}),u.dispatchEvent("lose")},x=new WeakSet,ee=function(){u.dispatchEvent("win")};const te=[{title:"flag",src:"data:image/svg+xml,%3C%3Fxml version='1.0' %3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg enable-background='new 0 0 32 32' height='32px' id='Layer_1' version='1.1' viewBox='0 0 32 32' width='32px' xml:space='preserve' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' style='stroke: %23202020; fill: %23202020'%3E%3Cg%3E%3Cpolyline fill='none' points='649,137.999 675,137.999 675,155.999 661,155.999' stroke='%23FFFFFF' stroke-linecap='round' stroke-linejoin='round' stroke-miterlimit='10' stroke-width='2' /%3E%3Cpolyline fill='none' points='653,155.999 649,155.999 649,141.999' stroke='%23FFFFFF' stroke-linecap='round' stroke-linejoin='round' stroke-miterlimit='10' stroke-width='2' /%3E%3Cpolyline fill='none' points='661,156 653,162 653,156' stroke='%23FFFFFF' stroke-linecap='round' stroke-linejoin='round' stroke-miterlimit='10' stroke-width='2' /%3E%3C/g%3E%3Cpath d='M23.317,10l5.441-6.349c0.255-0.296,0.313-0.714,0.149-1.069C28.745,2.228,28.391,2,28,2H4C3.448,2,3,2.448,3,3s0.448,1,1,1 h21.826l-4.585,5.349c-0.321,0.375-0.321,0.927,0,1.302L25.826,16H7v-4V7c0-0.552-0.448-1-1-1S5,6.448,5,7v5v5v11H4 c-0.552,0-1,0.447-1,1s0.448,1,1,1h4c0.552,0,1-0.447,1-1s-0.448-1-1-1H7V18h21c0.391,0,0.745-0.228,0.908-0.582 s0.105-0.772-0.149-1.069L23.317,10z' /%3E%3C/svg%3E"},{title:"bomb",src:"data:image/svg+xml,%3Csvg width='120' height='120' viewBox='0 0 120 120' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect x='75' y='10' width='35' height='100' fill='%23202020'/%3E%3Crect x='110' y='10' width='35' height='100' transform='rotate(90 110 10)' fill='%23202020'/%3E%3Crect x='45' y='110' width='35' height='100' transform='rotate(-180 45 110)' fill='%23202020'/%3E%3Crect x='10' y='110' width='35' height='100' transform='rotate(-90 10 110)' fill='%23202020'/%3E%3Crect x='110' y='35' width='10' height='50' fill='%23202020'/%3E%3Crect y='35' width='10' height='50' fill='%23202020'/%3E%3Crect x='35' y='10' width='10' height='50' transform='rotate(-90 35 10)' fill='%23202020'/%3E%3Crect x='35' y='120' width='10' height='50' transform='rotate(-90 35 120)' fill='%23202020'/%3E%3C/svg%3E%0A"}];var A,se;class ie{constructor(e){p(this,A);this.model=e,this.html=null,this.drawOptions=null,this.icons=[],f(this,A,se).call(this)}getHtml(){return this.html}bindLeftClick(e){this.html.addEventListener("mousedown",t=>{if(t.button===0){const s=t.offsetY,i=t.offsetX,n=this.findCellByCoords(s,i).id;n&&e(n)}})}bindRightClick(e){this.html.addEventListener("mousedown",t=>{if(t.button===2){const s=t.offsetY,i=t.offsetX,n=this.findCellByCoords(s,i).id;n&&e(n)}})}setSizes(){const{width:e,height:t,dpiWidth:s,dpiHeight:i}=this.drawOptions;this.html.style.width=e+"px",this.html.style.height=t+"px",this.html.width=s,this.html.height=i}updateView(){const{dpiWidth:e,dpiHeight:t}=this.drawOptions,s=this.model.getMatrix(),i=this.html.getContext("2d");i.clearRect(0,0,e,t),i.beginPath(),this.drawLines(i),this.drawCells(i,s),i.closePath()}drawLines(e){const{rowsCount:t,columnsCount:s,dpiWidth:i,dpiCellSize:n,linesLength:l,dpi:a}=this.drawOptions,d=(i-l*s)/s;e.strokeStyle=this.drawOptions.colors.stroke,e.lineWidth=a/2;for(let r=1;r<t;r++){const h=n*r;for(let c=0;c<s;c++){let m=d/2+c*n;e.moveTo(m,h),e.lineTo(m+l,h)}}for(let r=1;r<s;r++){const h=n*r;for(let c=0;c<t;c++){const m=d/2+c*n;e.moveTo(h,m),e.lineTo(h,m+l)}}e.stroke()}drawCells(e,t){const{dpiCellSize:s,shownCellSize:i}=this.drawOptions,{main:n,flag:l,mine:a}=this.drawOptions.colors;for(let d=0;d<t.length;d++)for(let r=0;r<t[d].length;r++){const{isOpen:h,isFlag:c,isMine:m,number:b}=t[d][r];let k="transparent",V="";h?m&&(k=a,V=this.icons.bomb):(k=n,c&&(k=l,V=this.icons.flag));const N=(s-i)/2+d*s,I=(s-i)/2+r*s,X=i/100*8;let R=b>0&&h&&!m?b:"";e.beginPath(),this.drawCell(e,I,N,i,X,k,R,V),e.closePath()}}drawCell(e,t,s,i,n=5,l,a,d){if(typeof n=="number")n={tl:n,tr:n,br:n,bl:n};else{const r={tl:0,tr:0,br:0,bl:0};for(const h in r)n[h]=n[h]||r[h]}if(e.moveTo(t+n.tl,s),e.lineTo(t+i-n.tr,s),e.quadraticCurveTo(t+i,s,t+i,s+n.tr),e.lineTo(t+i,s+i-n.br),e.quadraticCurveTo(t+i,s+i,t+i-n.br,s+i),e.lineTo(t+n.bl,s+i),e.quadraticCurveTo(t,s+i,t,s+i-n.bl),e.lineTo(t,s+n.tl),e.quadraticCurveTo(t,s,t+n.tl,s),e.fillStyle=l,e.fill(),a){const{colors:{text:r},font:{size:h,family:c}}=this.drawOptions;e.fillStyle=r,e.font=`${h}px ${c}`,e.fillText(a,t+i/2.9,s+i/1.5)}if(d){const{iconSize:r}=this.drawOptions,h=t+(i-r)/2,c=s+(i-r)/2;e.drawImage(d,h,c,r,r)}}preloadIcons(){for(const e of te){let t=new Image;t.onload=()=>t=this,t.src=e.src,this.icons[e.title]=t}}findCellByCoords(e,t){const{cellSize:s}=this.drawOptions,i=this.model.getMatrix();return e=Math.floor(e/s),t=Math.floor(t/s),i[e][t]}addCursorMoveEvents(){this.html.addEventListener("mousemove",e=>{const t=e.offsetY,s=e.offsetX,i=this.findCellByCoords(t,s);!i||(i.isOpen?this.html.style.cursor="default":this.html.style.cursor="pointer")})}}A=new WeakSet,se=function(){this.html=P({tagName:"canvas",className:"minesweeper-field"}),this.html.oncontextmenu=()=>!1;const{rowsCount:e,columnsCount:t}=this.model.getOptions(),s=2,i=50,n=i*t,l=i*e,a=n*s,d=l*s,r=i*s,h=r*.8,c=h*.6,m=r*.6;this.drawOptions=Object.freeze({colors:{main:"#e77d26",flag:"#646464",mine:"tomato",text:"#e5e5e5",stroke:"rgb(156, 156, 156)"},font:{size:48,family:"Roboto"},rowsCount:e,columnsCount:t,width:n,height:l,cellSize:i,dpi:s,dpiWidth:a,dpiHeight:d,dpiCellSize:r,shownCellSize:h,iconSize:c,linesLength:m}),this.setSizes(),this.preloadIcons(),this.updateView(),this.addCursorMoveEvents(),u.registerEvent("updatefield"),u.addEventListener("updatefield",this.updateView.bind(this))};class ne{constructor(e){this.options=e,this.model=null,this.view=null,this.loseCallback=null,this.winCallback=null}start(){this.model=new K(this.options),this.view=new ie(this.model),this.view.bindLeftClick(e=>{this.model.leftClickHandler(e)}),this.view.bindRightClick(e=>{this.model.rightClickHandler(e)}),u.registerEvent("lose"),u.registerEvent("win"),u.addEventListener("lose",()=>this.loseCallback()),u.addEventListener("win",()=>this.winCallback())}getView(){return this.view}onLose(e){this.loseCallback=e}onWin(e){this.winCallback=e}onMinesCounterChange(e){let t=this.model.getMinesNumber();e(t),u.addEventListener("updatefield",()=>{t=this.model.getMinesNumber(),e(t)})}}let v=new ne({rowsCount:10,columnsCount:10,minesCount:9});const W=document.querySelector("#app"),Y=W.querySelector(".header"),E=W.querySelector(".container");function q(o){var s;o.innerHTML="",v.start();const e=v.getView().getHtml();o.append(e),(s=Y.querySelector(".mines-counter"))==null||s.remove();const t=P({tagName:"div",className:"mines-counter"});v.onMinesCounterChange(i=>{t.innerHTML=`Mines left: <span>${i}</span>`}),Y.append(t)}q(E);const oe=re(E);function re(o){const e=v.getView().getHtml();let t={top:0,left:0,x:0,y:0},s=!1,i=!1;document.addEventListener("keydown",n),document.addEventListener("keyup",l),o.addEventListener("mousedown",a);function n(c){c.code==="Space"&&(c.preventDefault(),i=!0,s||(o.style.cursor="grab"),e.classList.add("no-pointer-events"))}function l(c){c.code==="Space"&&(i=!1,s||(o.style.cursor="default",e.classList.remove("no-pointer-events")))}function a(c){i&&(s=!0,o.style.cursor="grabbing",t={left:o.scrollLeft,top:o.scrollTop,x:c.clientX,y:c.clientY},o.addEventListener("mousemove",d),o.addEventListener("mouseup",r))}function d(c){const m=c.clientX-t.x,b=c.clientY-t.y;o.scrollTop=t.top-b,o.scrollLeft=t.left-m}function r(){o.removeEventListener("mousemove",d),o.removeEventListener("mouseup",r),s=!1,i||(o.style.cursor="default",e.classList.remove("no-pointer-events"))}function h(){document.removeEventListener("keydown",n),document.removeEventListener("keyup",l),o.removeEventListener("mousedown",a)}return h}v.onWin(()=>B("You Win!","win"));v.onLose(()=>B("You Lose","lose"));function B(o,e){oe();const t=P({tagName:"div",className:["end-screen",e]});t.innerHTML=`
        <div>${o}</div>
        <div>Click any button to restart</div>
    `;const s=()=>{q(E),t.removeEventListener("click",s),document.removeEventListener("keypress",s),t.remove()};t.addEventListener("click",s),document.addEventListener("keypress",s),E.append(t),E.classList.toggle("overflow-hidden")}
