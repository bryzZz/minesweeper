var z=(o,e,t)=>{if(!e.has(o))throw TypeError("Cannot "+t)};var p=(o,e,t)=>{if(e.has(o))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(o):e.set(o,t)};var u=(o,e,t)=>(z(o,e,"access private method"),t);const I=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}};I();function k(o,e){const t=o-.5+Math.random()*(e-o+1);return Math.round(t)}class U{constructor(e){this.name=e,this.callbacks=[]}registerCallback(e){this.callbacks.push(e)}}class G{constructor(){this.events={}}registerEvent(e){e in this.events&&delete this.events[e];const t=new U(e);this.events[e]=t}dispatchEvent(e,t){this.events[e].callbacks.forEach(s=>{s(t)})}addEventListener(e,t){this.events[e].registerCallback(t)}}const f=new G;function P({tagName:o,className:e,textContent:t,attributes:s,styles:i}){const n=document.createElement(o);if(t&&(n.textContent=t),e&&(Array.isArray(e)?n.classList.add(...e):n.classList.add(e)),s)for(const[r,d]of Object.entries(s))n.setAttribute(r,d);return i&&Object.assign(n.style,i),n}var O,J,T,Q,g,M,v,S,w,V,H,Z,A,_,L,N,F,ee;class K{constructor(e){p(this,O);p(this,T);p(this,g);p(this,v);p(this,w);p(this,H);p(this,A);p(this,L);p(this,F);this.options=e,this.matrix=u(this,O,J).call(this),this.isFirstClick=!0,this.highlightedCellCoords=null}getMatrix(){return this.matrix}getOptions(){return this.options}getMinesNumber(){let e=0;return u(this,g,M).call(this,t=>{t.isFlag&&(e+=1)}),this.options.minesCount-e}leftClickHandler(e){let t=null;if(u(this,g,M).call(this,a=>{a.id===e&&(t=a)}),this.isFirstClick){const a=[t,...u(this,v,S).call(this,t.y,t.x)];u(this,T,Q).call(this,a),this.isFirstClick=!1}const{isOpen:s,isMine:i,isFlag:n,number:r}=t;let d=!1;!s&&!n&&!i?(u(this,w,V).call(this,t),f.dispatchEvent("updatefield")):s&&r>0?(u(this,H,Z).call(this,t),f.dispatchEvent("updatefield")):!s&&!n&&i&&(u(this,L,N).call(this),d=!0,f.dispatchEvent("updatefield")),!d&&u(this,A,_).call(this)&&u(this,F,ee).call(this)}rightClickHandler(e){for(let t=0;t<this.matrix.length;t++)for(let s=0;s<this.matrix[t].length;s++){const i=this.matrix[t][s];if(i.id===e){i.isOpen||(i.isFlag=!i.isFlag),f.dispatchEvent("updatefield");break}}}}O=new WeakSet,J=function(){const{rowsCount:e,columnsCount:t}=this.options,s=[];let i=1;for(let n=0;n<e;n++){const r=[];for(let d=0;d<t;d++){const a={y:n,x:d,id:i.toString(),number:0,isOpen:!1,isMine:!1,isFlag:!1,isHighlighted:!1};r.push(a),i++}s.push(r)}return s},T=new WeakSet,Q=function(e){const{rowsCount:t,columnsCount:s,minesCount:i}=this.options,n=[];for(let r=0;r<i;r++){let d=k(0,t-1),a=k(0,s-1),l=this.matrix[d][a];for(;n.includes(l)||e.includes(l);)d=k(0,t-1),a=k(0,s-1),l=this.matrix[d][a];n.push(l),l.isMine=!0,u(this,v,S).call(this,l.y,l.x).forEach(h=>{h.number+=1})}},g=new WeakSet,M=function(e){const{matrix:t}=this;for(let s=0;s<t.length;s++)for(let i=0;i<t[s].length;i++)e(t[s][i])},v=new WeakSet,S=function(e,t,s=this.matrix){var n;const i=[];for(let r=-1;r<=1;r++)for(let d=-1;d<=1;d++){if(r===0&&d===0)continue;const a=(n=s==null?void 0:s[e+r])==null?void 0:n[t+d];a&&i.push(a)}return i},w=new WeakSet,V=function(e){!e.isMine&&!e.isFlag&&!e.isOpen?(e.isOpen=!0,e.number===0&&u(this,v,S).call(this,e.y,e.x).forEach(s=>{u(this,w,V).call(this,s)})):e.isMine&&u(this,L,N).call(this)},H=new WeakSet,Z=function(e){const t=u(this,v,S).call(this,e.y,e.x);let s=t.reduce((i,{isFlag:n})=>n?++i:i,0);e.number===s&&t.forEach(i=>{i.isFlag||u(this,w,V).call(this,i)})},A=new WeakSet,_=function(){let e=!0;return u(this,g,M).call(this,t=>{!t.isOpen&&!t.isMine&&(e=!1)}),e},L=new WeakSet,N=function(){u(this,g,M).call(this,e=>{e.isOpen=!0}),f.dispatchEvent("lose")},F=new WeakSet,ee=function(){f.dispatchEvent("win")};var q,ie;class te{constructor(e){p(this,q);this.model=e,this.html=null,this.drawOptions=null,u(this,q,ie).call(this)}getHtml(){return this.html}bindLeftClick(e){this.html.addEventListener("mousedown",t=>{if(t.button===0){const s=t.offsetY,i=t.offsetX,n=this.findCellByCoords(s,i).id;n&&e(n)}})}bindRightClick(e){this.html.addEventListener("mousedown",t=>{if(t.button===2){const s=t.offsetY,i=t.offsetX,n=this.findCellByCoords(s,i).id;n&&e(n)}})}setSizes(){const{width:e,height:t,dpiWidth:s,dpiHeight:i}=this.drawOptions;this.html.style.width=e+"px",this.html.style.height=t+"px",this.html.width=s,this.html.height=i}updateView(){const{dpiWidth:e,dpiHeight:t}=this.drawOptions,s=this.model.getMatrix(),i=this.html.getContext("2d");i.clearRect(0,0,e,t),i.beginPath(),this.drawLines(i),this.drawCells(i,s),i.closePath()}drawLines(e){const{rowsCount:t,columnsCount:s,dpiWidth:i,dpiCellSize:n,linesLength:r,dpi:d}=this.drawOptions,a=(i-r*s)/s;e.strokeStyle=this.drawOptions.colors.stroke,e.lineWidth=d/2;for(let l=1;l<t;l++){const h=n*l;for(let c=0;c<s;c++){let m=a/2+c*n;e.moveTo(m,h),e.lineTo(m+r,h)}}for(let l=1;l<s;l++){const h=n*l;for(let c=0;c<t;c++){const m=a/2+c*n;e.moveTo(h,m),e.lineTo(h,m+r)}}e.stroke()}drawCells(e,t){const{dpiCellSize:s,shownCellSize:i}=this.drawOptions,{main:n,flag:r,mine:d}=this.drawOptions.colors;for(let a=0;a<t.length;a++)for(let l=0;l<t[a].length;l++){const{isOpen:h,isFlag:c,isMine:m,number:y}=t[a][l];let E="transparent",W=null;h?m&&(E=d,W="../Group 4.svg"):(E=n,c&&(E=r));const X=(s-i)/2+a*s,D=(s-i)/2+l*s,x=i/100*8;let $=y>0&&h&&!m?y:"";e.beginPath(),this.drawCell(e,D,X,i,x,E,$,W),e.closePath()}}drawCell(e,t,s,i,n=5,r,d,a){if(typeof n=="number")n={tl:n,tr:n,br:n,bl:n};else{const l={tl:0,tr:0,br:0,bl:0};for(const h in l)n[h]=n[h]||l[h]}if(e.moveTo(t+n.tl,s),e.lineTo(t+i-n.tr,s),e.quadraticCurveTo(t+i,s,t+i,s+n.tr),e.lineTo(t+i,s+i-n.br),e.quadraticCurveTo(t+i,s+i,t+i-n.br,s+i),e.lineTo(t+n.bl,s+i),e.quadraticCurveTo(t,s+i,t,s+i-n.bl),e.lineTo(t,s+n.tl),e.quadraticCurveTo(t,s,t+n.tl,s),e.fillStyle=r,e.fill(),d){const{colors:{text:l},font:{size:h,family:c}}=this.drawOptions;e.fillStyle=l,e.font=`${h}px ${c}`,e.fillText(d,t+i/2.9,s+i/1.5)}}findCellByCoords(e,t){const{cellSize:s}=this.drawOptions,i=this.model.getMatrix();return e=Math.floor(e/s),t=Math.floor(t/s),i[e][t]}addCursorMoveEvents(){this.html.addEventListener("mousemove",e=>{const t=e.offsetY,s=e.offsetX,i=this.findCellByCoords(t,s);!i||(i.isOpen?this.html.style.cursor="default":this.html.style.cursor="pointer")})}}q=new WeakSet,ie=function(){this.html=P({tagName:"canvas",className:"minesweeper-field"}),this.html.oncontextmenu=()=>!1;const{rowsCount:e,columnsCount:t}=this.model.getOptions(),s=2,i=50,n=i*t,r=i*e,d=n*s,a=r*s,l=i*s,h=l*.8,c=l*.6;this.drawOptions=Object.freeze({colors:{main:"red",flag:"#646464",mine:"tomato",text:"#e5e5e5",stroke:"rgb(156, 156, 156)"},font:{size:48,family:"Roboto"},rowsCount:e,columnsCount:t,width:n,height:r,cellSize:i,dpi:s,dpiWidth:d,dpiHeight:a,dpiCellSize:l,shownCellSize:h,linesLength:c}),this.setSizes(),this.updateView(),this.addCursorMoveEvents(),f.registerEvent("updatefield"),f.addEventListener("updatefield",this.updateView.bind(this))};class se{constructor(e){this.options=e,this.model=null,this.view=null,this.loseCallback=null,this.winCallback=null}start(){this.model=new K(this.options),this.view=new te(this.model),this.view.bindLeftClick(e=>{this.model.leftClickHandler(e)}),this.view.bindRightClick(e=>{this.model.rightClickHandler(e)}),f.registerEvent("lose"),f.registerEvent("win"),f.addEventListener("lose",()=>this.loseCallback()),f.addEventListener("win",()=>this.winCallback())}getView(){return this.view}onLose(e){this.loseCallback=e}onWin(e){this.winCallback=e}onMinesCounterChange(e){let t=this.model.getMinesNumber();e(t),f.addEventListener("updatefield",()=>{t=this.model.getMinesNumber(),e(t)})}}let C=new se({rowsCount:10,columnsCount:10,minesCount:9});const Y=document.querySelector("#app"),j=Y.querySelector(".header"),b=Y.querySelector(".container");function B(o){var s;o.innerHTML="",C.start();const e=C.getView().getHtml();o.append(e),(s=j.querySelector(".mines-counter"))==null||s.remove();const t=P({tagName:"div",className:"mines-counter"});C.onMinesCounterChange(i=>{t.innerHTML=`Mines left: <span>${i}</span>`}),j.append(t)}B(b);const ne=oe(b);function oe(o){const e=C.getView().getHtml();let t={top:0,left:0,x:0,y:0},s=!1,i=!1;document.addEventListener("keydown",n),document.addEventListener("keyup",r),o.addEventListener("mousedown",d);function n(c){c.code==="Space"&&(c.preventDefault(),i=!0,s||(o.style.cursor="grab"),e.classList.add("no-pointer-events"))}function r(c){c.code==="Space"&&(i=!1,s||(o.style.cursor="default",e.classList.remove("no-pointer-events")))}function d(c){i&&(s=!0,o.style.cursor="grabbing",t={left:o.scrollLeft,top:o.scrollTop,x:c.clientX,y:c.clientY},o.addEventListener("mousemove",a),o.addEventListener("mouseup",l))}function a(c){const m=c.clientX-t.x,y=c.clientY-t.y;o.scrollTop=t.top-y,o.scrollLeft=t.left-m}function l(){o.removeEventListener("mousemove",a),o.removeEventListener("mouseup",l),s=!1,i||(o.style.cursor="default",e.classList.remove("no-pointer-events"))}function h(){document.removeEventListener("keydown",n),document.removeEventListener("keyup",r),o.removeEventListener("mousedown",d)}return h}C.onWin(()=>R("You Win!","win"));C.onLose(()=>R("You Lose","lose"));function R(o,e){ne();const t=P({tagName:"div",className:["end-screen",e]});t.innerHTML=`
        <div>${o}</div>
        <div>Click any button to restart</div>
    `;const s=()=>{B(b),t.removeEventListener("click",s),document.removeEventListener("keypress",s),t.remove()};t.addEventListener("click",s),document.addEventListener("keypress",s),b.append(t),b.classList.toggle("overflow-hidden")}console.log("updated");
